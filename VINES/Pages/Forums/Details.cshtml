@page
@model VINES.Pages.Forums.DetailsModel
@using Microsoft.AspNetCore.Authorization
@inject IAuthorizationService AuthorizationService
@using VINES.Models
@{
    ViewData["Title"] = "Forum Post Details";
}
@if ((await AuthorizationService.AuthorizeAsync(User, "PatientOnly")).Succeeded)
{
    <div class="blog-page area-padding">
        <h4 class="text-primary">Details</h4>
        <hr />
        <div class="row">
            <div class="col-md-4">
                    <input type="hidden" asp-for="forumpost.forumPostID" />

                    <div class="form-group">
                        <label asp-for="forumpost.forumTitle" class="control-label">Title: </label>
                        <br />
                        @Html.DisplayFor(m => m.forumpost.forumTitle)
                    </div>

                    <div class="form-group">
                        <label asp-for="forumpost.forumCategory" class="control-label">Category: </label>
                        <br />
                        @Html.DisplayFor(m => m.forumpost.forumCategory.forumCategory)
                    </div>

                    <div class="form-group">
                        <label asp-for="forumpost.forumContent" class="control-label">Content: </label>
                        <br />
                        @Html.DisplayFor(m => m.forumpost.forumContent)
                    </div>
            </div>
        </div>

        <div class="border container" style="padding:30px;">
            <form method="post">
                <div class="form-group row">
                    <div class="col-4">
                        <label>Add a comment</label>
                    </div>
                    <div class="col-6">
                        <input asp-for="comment.comment" class="form-control" name="comment" required />
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-3 offset-4">
                        <input type="submit" value="Create" class="btn btn-primary btn-sm text-white" />
                    </div>
                </div>
            </form>
        </div>

        <div>
            @if (Model.comments.Count() > 0)
            {
                <table class="table table-striped border">
                    <tr class="table-secondary">
                        <th>
                            User
                        </th>
                        <th>
                            Comment
                        </th>
                    </tr>
                    @foreach (var com in Model.comments)
                    {
                        <tr>
                            <td>
                                @Html.DisplayFor(m => com.userID)
                            </td>
                            <td>
                                @Html.DisplayFor(m => com.comment)
                            </td>
                        </tr>
                    }
                </table>
            }
            else
            {
                <p>No comments yet</p>
            }
        </div>

        <div class="px-2">
            <div class="col-3">
                <a asp-page="Index" class="btn btn-success btn-sm text-white">Back to Index</a>
            </div>
        </div>

    </div>
}
else
{
    @if (User.Identity.IsAuthenticated && User.IsInRole("Patient"))
    {

        Response.Redirect("/patientLanding");
    }
    else if (User.Identity.IsAuthenticated && User.IsInRole("Advertiser"))
    {

        Response.Redirect("/advertiserLanding");
    }
    else
    {
        Response.Redirect("/Index");
    }
}
